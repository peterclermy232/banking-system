<div class="dashboard-container">
  <div class="welcome-section">
    <div class="welcome-text">
      <h1>Welcome back, {{ currentUser?.first_name || 'Member' }}!</h1>
      <p>Member #{{ currentUser?.member_number }} • Total Balance: KSH {{ totalBalance | number:'1.2-2' }}</p>
    </div>
    <div class="notification-bell" (click)="showNotifications = !showNotifications">
      <i class="fas fa-bell"></i>
      <span class="notification-count">{{ notifications.length }}</span>
    </div>
  </div>

  <!-- Account Cards -->
  <div class="accounts-grid">
    <div class="account-card"
         *ngFor="let account of accounts; let first = first"
         [class.primary]="first">
      <div class="account-header">
        <h3>{{ account.account_type | titlecase }}</h3>
        <i class="fas fa-wallet"></i>
      </div>
      <div class="account-balance">
        <span class="currency">KSH</span>
        <span class="amount">{{ account.balance | number:'1.2-2' }}</span>
      </div>
      <div class="account-number">{{ account.account_number }}</div>
      <div class="account-status">
        <span class="status-badge" [class]="account.status">{{ account.status | titlecase }}</span>
      </div>
    </div>

    <!-- Loading placeholder -->
    <div class="account-card skeleton" *ngIf="isLoadingAccounts">
      <div class="skeleton-header"></div>
      <div class="skeleton-balance"></div>
      <div class="skeleton-number"></div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions">
    <h2>Quick Actions</h2>
    <div class="actions-grid">
      <div class="action-card" (click)="navigateTo('/transfer')">
        <div class="action-icon transfer">
          <i class="fas fa-exchange-alt"></i>
        </div>
        <h4>Send Money</h4>
        <p>Transfer to members</p>
      </div>

      <div class="action-card" (click)="navigateTo('/loans')">
        <div class="action-icon loan">
          <i class="fas fa-hand-holding-usd"></i>
        </div>
        <h4>Apply Loan</h4>
        <p>Quick loan application</p>
      </div>

      <div class="action-card" (click)="navigateTo('/savings')">
        <div class="action-icon savings">
          <i class="fas fa-piggy-bank"></i>
        </div>
        <h4>Save Money</h4>
        <p>Deposit to savings</p>
      </div>

      <div class="action-card" (click)="openDepositModal()">
        <div class="action-icon deposit">
          <i class="fas fa-plus-circle"></i>
        </div>
        <h4>Quick Deposit</h4>
        <p>Add money to account</p>
      </div>
    </div>
  </div>

  <!-- Recent Transactions -->
  <div class="transactions-section">
    <div class="section-header">
      <h2>Recent Transactions</h2>
      <a href="#" class="view-all" (click)="loadMoreTransactions()">View All</a>
    </div>

    <div class="transactions-list" *ngIf="!isLoadingTransactions">
      <div class="transaction-item" *ngFor="let transaction of recentTransactions">
        <div class="transaction-icon" [class]="transaction.transaction_type">
          <i [class]="getTransactionIcon(transaction.transaction_type)"></i>
        </div>
        <div class="transaction-details">
          <h4>{{ transaction.description || getTransactionDescription(transaction) }}</h4>
          <p>{{ transaction.created_at | date:'MMM d, y' }} • {{ transaction.status | titlecase }}</p>
        </div>
        <div class="transaction-amount" [class]="getAmountClass(transaction)">
          {{ getAmountPrefix(transaction) }}KSH {{ transaction.amount | number:'1.2-2' }}
        </div>
      </div>

      <div class="no-transactions" *ngIf="recentTransactions.length === 0">
        <i class="fas fa-receipt"></i>
        <p>No recent transactions</p>
      </div>
    </div>

    <!-- Loading skeleton -->
    <div class="transactions-skeleton" *ngIf="isLoadingTransactions">
      <div class="transaction-skeleton" *ngFor="let item of [1,2,3]">
        <div class="skeleton-icon"></div>
        <div class="skeleton-details">
          <div class="skeleton-title"></div>
          <div class="skeleton-subtitle"></div>
        </div>
        <div class="skeleton-amount"></div>
      </div>
    </div>
  </div>

  <!-- Financial Overview -->
  <div class="overview-section">
    <h2>Financial Overview</h2>
    <div class="overview-cards">
      <div class="overview-card">
        <div class="overview-icon income">
          <i class="fas fa-arrow-up"></i>
        </div>
        <div class="overview-data">
          <h3>KSH {{ monthlyIncome | number:'1.2-2' }}</h3>
          <p>Monthly Income</p>
        </div>
      </div>

      <div class="overview-card">
        <div class="overview-icon expenses">
          <i class="fas fa-arrow-down"></i>
        </div>
        <div class="overview-data">
          <h3>KSH {{ monthlyExpenses | number:'1.2-2' }}</h3>
          <p>Monthly Expenses</p>
        </div>
      </div>

      <div class="overview-card">
        <div class="overview-icon credit">
          <i class="fas fa-chart-line"></i>
        </div>
        <div class="overview-data">
          <h3>{{ creditScore }}</h3>
          <p>Credit Score</p>
        </div>
      </div>

      <div class="overview-card">
        <div class="overview-icon share">
          <i class="fas fa-coins"></i>
        </div>
        <div class="overview-data">
          <h3>KSH {{ shareCapital | number:'1.2-2' }}</h3>
          <p>Share Capital</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Deposit Modal -->
  <div class="modal-overlay" *ngIf="showDepositModal" (click)="closeDepositModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Quick Deposit</h3>
        <button class="close-btn" (click)="closeDepositModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form [formGroup]="depositForm" (ngSubmit)="submitDeposit()">
        <div class="form-group">
          <label>Select Account</label>
          <select formControlName="accountId" class="form-control">
            <option value="">Choose account</option>
            <option *ngFor="let account of accounts" [value]="account.id">
              {{ account.account_type | titlecase }} - {{ account.account_number }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label>Amount (KSH)</label>
          <input
            type="number"
            formControlName="amount"
            class="form-control"
            placeholder="0.00"
            min="1">
        </div>

        <div class="form-group">
          <label>Description (Optional)</label>
          <input
            type="text"
            formControlName="description"
            class="form-control"
            placeholder="What's this deposit for?">
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-secondary" (click)="closeDepositModal()">
            Cancel
          </button>
          <button
            type="submit"
            class="btn-primary"
            [disabled]="depositForm.invalid || isProcessingDeposit">
            <i class="fas fa-spinner fa-spin" *ngIf="isProcessingDeposit"></i>
            <i class="fas fa-plus-circle" *ngIf="!isProcessingDeposit"></i>
            {{ isProcessingDeposit ? 'Processing...' : 'Deposit Money' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
