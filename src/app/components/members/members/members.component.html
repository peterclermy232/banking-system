<div class="members-container">
  <div class="page-header">
    <h1>Members Management</h1>
    <div class="header-actions">
      <button class="btn-icon" title="Refresh Data" (click)="refreshData()">
        <i class="fas fa-sync-alt">Refresh</i>
      </button>
      <button class="btn-icon" title="Export Members" (click)="exportMembers()">
        <i class="fas fa-download">Export</i>
      </button>
      <button class="btn-primary" (click)="addNewMember()">
        <i class="fas fa-user-plus"></i>
        Add Member
      </button>
    </div>
  </div>

  <!-- Filters and Search Row -->
  <div class="members-filters-row">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (input)="filterMembers()"
        placeholder="Search members...">
    </div>
    <div class="filter-group">
      <label>Status:</label>
      <select [(ngModel)]="statusFilter" (change)="filterMembers()" class="filter-select">
        <option value="">All Status</option>
        <option value="active">Active</option>
        <option value="inactive">Inactive</option>
        <option value="suspended">Suspended</option>
      </select>
    </div>
    <div class="filter-group">
      <label>Join Date:</label>
      <select [(ngModel)]="dateFilter" (change)="filterMembers()" class="filter-select">
        <option value="">All Time</option>
        <option value="thisMonth">This Month</option>
        <option value="last3Months">Last 3 Months</option>
        <option value="thisYear">This Year</option>
      </select>
    </div>
    <div class="filter-group">
      <label>Sort By:</label>
      <select [(ngModel)]="sortBy" (change)="sortMembers()" class="filter-select">
        <option value="memberNumber">Member Number</option>
        <option value="firstName">First Name</option>
        <option value="joinDate">Join Date</option>
        <option value="totalSavings">Total Savings</option>
      </select>
    </div>
  </div>

  <!-- Members Stats -->
  <div class="members-stats">
    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-users"></i>
      </div>
      <div>
        <h3>{{ totalMembers }}</h3>
        <p>Total Members</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon active">
        <i class="fas fa-user-check"></i>
      </div>
      <div>
        <h3>{{ activeMembers }}</h3>
        <p>Active Members</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon new">
        <i class="fas fa-user-plus"></i>
      </div>
      <div>
        <h3>{{ newMembers }}</h3>
        <p>New This Month</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon savings">
        <i class="fas fa-piggy-bank"></i>
      </div>
      <div>
        <h3>KSH {{ totalMemberSavings | number:'1.2-2' }}</h3>
        <p>Total Savings</p>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
    </div>
    <p>Loading members...</p>
  </div>

  <!-- Members Table -->
  <div class="members-table-container" *ngIf="!loading">
    <div class="table-header">
      <h3>Members List</h3>
      <div class="table-info">
        Showing {{ paginatedMembers.length }} of {{ totalMembers }} members
      </div>
    </div>

    <div class="table-wrapper">
      <table class="members-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Member #</th>
            <th>Name</th>
            <th>Contact</th>
            <th>Join Date</th>
            <th>Status</th>
            <th>Savings</th>
            <th>Loan Balance</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let member of paginatedMembers; let i = index"
              class="member-row"
              (click)="viewMemberDetails(member)">
            <td>{{ (currentPage - 1) * pageSize + i + 1 }}</td>
            <td class="member-number">{{ member.memberNumber }}</td>
            <td>
              <div class="member-info">
                <div class="member-avatar">
                  {{ member.firstName.charAt(0) }}{{ member.lastName.charAt(0) }}
                </div>
                <div class="member-details">
                  <strong>{{ member.firstName }} {{ member.lastName }}</strong>
                </div>
              </div>
            </td>
            <td>
              <div class="contact-info">
                <div class="email">{{ member.email }}</div>
                <div class="phone">{{ member.phoneNumber }}</div>
              </div>
            </td>
            <td>{{ member.dateJoined | date:'MMM d, y' }}</td>
            <td>
              <span class="status-badge" [ngClass]="member.status">
                <i class="fas fa-circle"></i>
                {{ member.status | titlecase }}
              </span>
            </td>
            <td class="amount">KSH {{ member.totalSavings | number:'1.2-2' }}</td>
            <td class="amount">KSH {{ member.loanBalance | number:'1.2-2' }}</td>
            <td class="actions-cell" (click)="$event.stopPropagation()">
              <div class="action-buttons">
                <button class="btn-action view"
                        title="View Details"
                        (click)="viewMemberDetails(member)">
                  <i class="fas fa-eye">View</i>
                </button>
                <!-- <button class="btn-action edit"
                        title="Edit Member"
                        (click)="editMember(member)">
                  <i class="fas fa-edit">edit</i>
                </button> -->
                <!-- <div class="dropdown">
                  <button class="btn-action more" title="More Actions">
                    <i class="fas fa-ellipsis-v">More</i>
                  </button>
                  <div class="dropdown-content">
                    <a href="#" (click)="$event.preventDefault()">
                      <i class="fas fa-ban">Suspend</i>
                    </a>
                    <a href="#" (click)="$event.preventDefault()">
                      <i class="fas fa-print">Print</i>
                    </a>
                    <a href="#" (click)="$event.preventDefault()">
                      <i class="fas fa-download">Export</i>
                    </a>
                  </div>
                </div> -->
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="paginatedMembers.length === 0">
      <div class="empty-icon">
        <i class="fas fa-users"></i>
      </div>
      <h3>No Members Found</h3>
      <p>No members match your current search criteria.</p>
      <button class="btn-primary" (click)="addNewMember()">
        <i class="fas fa-user-plus"></i>
        Add First Member
      </button>
    </div>

    <!-- Pagination Controls -->
<div class="pagination-controls" *ngIf="paginatedMembers.length > 0">
  <div class="pagination-info">
    Page {{ currentPage }} of {{ totalPages }}
  </div>
  <div class="pagination-buttons">
    <button class="btn-pagination"
            (click)="prevPage()"
            [disabled]="currentPage === 1">
      <i class="fas fa-chevron-left"></i>
      Previous
    </button>
    <div class="page-numbers">
      <!-- Fixed the ngFor and ngIf structure -->
      <ng-container *ngFor="let page of getPageNumbers(); let i = index">
        <button class="btn-page"
                [class.active]="currentPage === page"
                (click)="goToPage(page)"
                *ngIf="shouldShowPage(page)">
          {{ page }}
        </button>
      </ng-container>
    </div>
    <button class="btn-pagination"
            (click)="nextPage()"
            [disabled]="currentPage === totalPages">
      Next
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>
</div>
  </div>
</div>
